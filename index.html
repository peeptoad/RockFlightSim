<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rocket Flight Simulator</title>
    <style>
        canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <h1>Rocket Flight Simulator</h1>
    
    <!-- Canvas for Visualization -->
    <canvas id="flightCanvas" width="800" height="400"></canvas>

    <!-- Script to simulate flight -->
    <script>
        // Constants
        const GRAVITY = 9.81; // m/s^2
        const AIR_DENSITY = 1.225; // kg/m^3 (standard air density)

        // Rocket parameters (retrieve from localStorage)
        const rocketLength = parseFloat(localStorage.getItem('rocketLength')) * 0.0254; // Convert inches to meters
        const rocketDiameter = parseFloat(localStorage.getItem('rocketDiameter')) * 0.0254; // Convert inches to meters
        const rocketWeight = parseFloat(localStorage.getItem('rocketWeight')) * 0.453592; // Convert pounds to kilograms

        // Engine characteristics (retrieve from localStorage)
        const specificImpulse = parseFloat(localStorage.getItem('specificImpulse'));
        const burnTime = parseFloat(localStorage.getItem('burnTime'));
        const ejectionChargeTime = parseFloat(localStorage.getItem('ejectionChargeTime'));

        // Simulation parameters
        const timeStep = 0.05; // seconds
        const simulationTime = Math.max(burnTime, ejectionChargeTime) + 10; // seconds
        let currentTime = 0;
        let rocketAltitude = 0; // meters
        let rocketVelocity = 0; // m/s
        let rocketAcceleration = 0; // m/s^2

        // Canvas setup
        const canvas = document.getElementById('flightCanvas');
        const ctx = canvas.getContext('2d');
        const scaleFactor = 20; // Pixels per meter

        // Main simulation loop
        function simulateFlight() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw ground
            ctx.beginPath();
            ctx.moveTo(0, canvas.height / 2);
            ctx.lineTo(canvas.width, canvas.height / 2);
            ctx.strokeStyle = 'black';
            ctx.stroke();

            // Reset simulation variables
            currentTime = 0;
            rocketAltitude = 0;
            rocketVelocity = 0;
            rocketAcceleration = 0;

            // Simulation loop
            while (currentTime < simulationTime) {
                // Calculate forces
                let gravityForce = rocketWeight * GRAVITY;
                let dragForce = calculateDragForce(rocketVelocity);
                let thrustForce = calculateThrust(currentTime);

                // Update rocket motion using Euler method
                rocketAcceleration = (thrustForce - gravityForce - dragForce) / rocketWeight;
                rocketVelocity += rocketAcceleration * timeStep;
                rocketAltitude += rocketVelocity * timeStep;

                // Draw rocket on canvas
                drawRocket();

                // Check for end of burn
                if (currentTime >= burnTime && currentTime < ejectionChargeTime) {
                    // Rocket engine burnout, continue coasting
                    ctx.fillStyle = 'red';
                    ctx.fillText('Engine burnout', 10, 20);
                }

                // Update time
                currentTime += timeStep;
            }
        }

        // Function to calculate drag force
        function calculateDragForce(velocity) {
            // Placeholder calculation (considering only linear drag)
            let dragCoefficient = 0.5; // Placeholder value (adjust as needed)
            let crossSectionalArea = Math.PI * (rocketDiameter / 2) ** 2;
            return 0.5 * AIR_DENSITY * velocity ** 2 * dragCoefficient * crossSectionalArea;
        }

        // Function to calculate thrust force
        function calculateThrust(time) {
            // Placeholder calculation (linear thrust ramp)
            let maxThrust = specificImpulse * rocketWeight * GRAVITY; // Newtons
            return (time / burnTime) * maxThrust;
        }

        // Function to draw rocket on canvas
        function drawRocket() {
            // Convert altitude to canvas coordinates
            let rocketY = canvas.height / 2 - rocketAltitude * scaleFactor;

            // Draw rocket body
            ctx.fillStyle = 'blue';
            ctx.fillRect(100, rocketY, rocketLength * scaleFactor, rocketDiameter * scaleFactor);

            // Draw rocket nose
            ctx.beginPath();
            ctx.moveTo(100 + rocketLength * scaleFactor, rocketY + rocketDiameter * scaleFactor / 2);
            ctx.lineTo(100 + rocketLength * scaleFactor, rocketY - rocketDiameter * scaleFactor / 2);
            ctx.lineTo(100 + rocketLength * scaleFactor + 20, rocketY);
            ctx.closePath();
            ctx.fill();
        }
    </script>
</body>
</html>

